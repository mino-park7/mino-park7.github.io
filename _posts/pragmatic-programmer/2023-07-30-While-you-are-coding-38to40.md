---
layout: "post"
title: "7. 코딩하는 동안 38~40"
date: "2023-07-30 22:22+0900"
category: Progmatic Programmer
tag: [Progmatic Programmer]
---

# Topic 38. 우연에 맡기는 프로그래밍

- 지뢰를 찾는 병사처럼 개발자는 지뢰밭에서 일한다.
- 하루에도 수백 개가 넘는 함정에 우리가 빠지기를 기대리고 있다.
- 우리는 우연에 맡기는 프로그래밍, 곧 행운과 우연한 성공에 의존하는 프로그래밍을 하지 않아야 함
- 대신 "의도적으로 프로그래밍"해야 한다.

## 우연에 맡기는 프로그래밍 하기 (Anti-pattern)

### 예시 (개발자 프레드)

- 프레드는 정확한 검증없이 코드를 덧붙이는 작업을 몇 주간 하였다.
- 갑자기 프로그램이 잘 돌아가지 않음
- 몇 시간 동안 고치려고 노력했지만 원인을 찾을 수 없음

### 분석

- 왜 코드가 망가졌는지 프레드가 모르는 까닭은 애초에 **코드가 왜 잘 돌아가는지는 몰랐기 때문**이다.
- 프레드가 **제한적**으로 '테스트'를 했을 때에는 코드가 잘 돌아가는 것 처럼 보였지만, 그것은 단지 그때 운이 좋았기 때문

### 구현에서 생기는 우연

- 어떤 루틴을 잘못된 데이터를 가지고 호출했다고 해 보자.
- 그 루틴은  예상하지 못한 데이터에 특정한 방식으로 반응을 하고, 여러분은 그 반을을 기반으로 코드를 작성한다.
- 하지만 루틴을 만든 사람의 의도는 그 루틴이 그런 식으로 작동하는 것이 아니었다.
- 이상하게 코드를 짜서 **우연히** 동작을 하게 된다면 그것을 고치지 않으려고 할 가능성이 크다.
- 잘 작동하는 데 괜히 건드려서 일을 만들 필요가 있을까? 우리가 보기에는 그래야 할 이유가 몇 가지 있다.
  - 정말로 제대로 돌아가는 게 아닐지도 모른다. 그저 돌아가는 듯이 보이는 것일 수도 있다.
  - 여러분이 의존하는 조건이 단지 우연인 경우도 있다. 화면 해상도가 다른 경우나 CPU 코어가 더 많은 경우 들 다른 상황에서는 이상하게 작동할지도 모른다.
  - 문서화 되지 않은 동작은 라이브러리의 다음 릴리스에서 변경될 수도 있다.
  - 불필요한 추가 호출은 코드를 더 느리게 만든다.
  - 추가로 호출한 루틴에 새로운 버그가 생길 수도 있다.
- 다른 사람이 호출할 코드를 작성하고 있다면 모듈화를 잘하는 것, 그리고 잘 문서화한 적은 수의 인터페이스 아래에 구현을 숨기는 것 같은 기본 원칙들이 모두 도움이 됨
- 다른 루틴을 호출할 때도 문서화된 동작에만 의존하라.
- 어떤 이유로든 그럴 수 없다면 추측을 문서로 상세히 남겨라

### 비슷하다고 괜찮을 리는 없다

- UTC 관련 썰, 책 참고

### 유령 패턴

- 우연히 생긴 패턴들을 연역적으로 생긴 것이라고 생각하지 마라
- ex. 러시아 국가 수반 패턴
- 가정하지 말라. 증명하라.

### 상황에서 생기는 우연

- 특정한 상황에서 빚어지는 우연도 있음
- 여러분이 짜는 코드가 GUI에서만 작동한다고 **가정**하고 있지 않은가?
- 언제나 한국어 또는 영어라고 **가정**하고 있지 않은가?
- 언제나 사용자가 글을 읽을 수 있다고 생각하는가?
- 현재 디렉터리에 쓸 수 있다는 것에 **의존**하고 있지 않은가?
- 어떤 환경 변수나 설정 파일이 미리 **존재**한다는 것은?
- 서버의 시간이 **정확**하다는 것은?
- 네트워크를 쓸 수 있고, 속도가 어느 정도 이상이라는 것에 **의존**하지는 않는가?
- 인터넷 검색으로 찾은 첫 번째 답에서 코드를 복사해 올 때 여러분과 동인한 상황이라고 확신하는가?
  - 아니면 의미는 신경 쓰지 않고 그냥 따라 하는 **화물 숭배 cargo cult** 코드를 만들고 있나?

> Tip 62. 우연에 맡기는 프로그래밍을 하지 말라.

### 암묵적인 가정

- 우연은 여러 단계에서 우리를 오도할 수 있다.
- 테스트가 특히 가짜 원인과 우연한 결과로 가득 찬 영역이다.
- X의 원인은 Y라고 가정하기는 쉽다. 하지만 가정하지 말라. 증명하라.
- 확고한 사실에 근거하지 않은 가정은 어떤 프로젝트에서든 재앙의 근원이 된다.

## 의도적으로 프로그래밍하기

- 언제나 여러분이 지금 무엇을 하고 있는지 알아야 한다.
- 더 경험이 적은 프로그래머에게 코드를 상세히 설명할 수 있는가? 그렇지 않다면 아마 우연에 기대고 있는 것일 터이다.
- 자신도 잘 모르는 코드를 만들지 말라. 완전히 파악하지 못한 애플리케이션을 빌드하거나, 이해하지 못한 기술을 사용하면 우연의 함정에 빠질 가능성이 높다. 이것이 왜 동작하는지 잘 모른다면 왜 실패하는지도 알 리가 없다.
- 계획을 세우고 그것을 바탕으로 진행하라. 머릿속에 있는 계획이든, 냅킨이나 화이프보드에 적어놓은 계획이든 상관없다.
- 신뢰할 수 있는 것에만 기대라. 가정에 의존하지 말라. 무언가를 신회할 수 있을지 판단하기 어렵다면 일단 최악의 상황을 가정하라.
- 가정을 기록으로 남겨라. 자신의 마음속에서 가정을 명확하게 하는 데 도움이 될 뿐더러, 다른 사람과 그에 대해 소통하는 데에도 도움이 된다.
- 코드뿐 아니라 여러분이 세운 가정도 테스트해 보아야 한다. 어떤 일이든 추측만 하지 말고 실제로 시험해 보라. 여러분의 가정을 시험할 수 있는 단정문을 작성하라. 가정이 맞았다면 코드를 더 이해하기 쉽게 만든 셈이고, 가정이 틀렸다면 일찍 발견했으니 운이 좋았다고 생각하라.
- 노력을 기울일 대상의 우선순위를 정하라. 중요한 것에 먼저 시간을 투자하라. 중요한 부분이 가장 어려운 부분이기도 한 경우가 많다. 기본이나 기반 구조가 제대로 되어 있지 않다면 현란한 부가 기능도 다 부질없다.
- 과거의 노예가 되지 말라. 기존 코드가 앞으로 짤 코드를 지배하도록 놓아두지 말라. 언제나 리팩터링 할 자세가 되어 있어야 한다. 이런 결정이 프로젝트 일정에 영햐을 줄지도 모른다. 그러니 필요한 변경을 하지 않을 경우의 비용보다 일정이 늦어져서 발생하는 비용이 적어야 한다는 것을 염두에 두어라.


